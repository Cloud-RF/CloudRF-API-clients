<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>CloudRF 3D Model Gallery</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.5.0/model-viewer.min.js"></script>

    <style>
        body, html {
            height: 100%;
        }

        .full-height {
            height: 100vh;
            max-height: 100vh;
            margin: 0;
            padding: 0;
        }

        .bg-brand {
            background-color: #e39b0c;
        }
    </style>
</head>

<body>
    <div class="container-fluid d-flex flex-column full-height">
        <header class="bg-brand text-black text-center p-1 fs-3">
            CloudRF 3D Model Gallery
        </header>

        <main class="flex-fill d-flex flex-column">
            <aside class="bg-secondary text-white d-flex overflow-y-auto gap-3 p-2" id="thumbnails"></aside>
            
            <div class="bg-light flex-fill p-3">
                <div class="d-flex justify-content-between">
                    <div id="demoDescription">Please select a model.</div>
                    <div id="demoViewer"></div>
                </div>
            </div>
        </main>

        <footer class="bg-dark text-white text-center p-3">
            <a href="https://cloudrf.com/" target="_blank" class="text-white">CloudRF - Online radio planning software</a>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

    <script>
        const demos = [
            {
                name: 'Subway (Small)',
                thumbnailImage: 'subway_small.png',
                model: 'subway_small.glb',
                description: 'This is the description for the small subway model.',
                requestJson: {
                    "transmitters": [
                        {
                            "frq": 2432.0,
                            "txw": 0.05,
                            "pos": {
                                "x": 10,
                                "y": 4,
                                "z": 0
                            },
                            "antenna": {
                                "ant": 1,
                                "azi": 0,
                                "tlt": 0,
                                "pol": "v",
                                "hbw": 120,
                                "vbw": 120,
                                "txg": 0,
                                "fbr": 9,
                                "txl": 0
                            }
                        }
                    ],
                    "receiver": {
                        "rxg": 0,
                        "rxs": -80
                    },
                    "3d": {
                        "input_file": "subway_small.glb",
                        "max_reflections": 5
                    },
                    "output": {
                        "res": 0.7,
                        "col": "LTE.dBm",
                        "out": 2
                    },
                    "default_material": { 
                        "reflection_loss": 9.0,
                        "transmission_loss": 15.0,
                        "diffusion": 1.0
                    },
                    "materials": [
                        {
                            "keys": [
                                "Wood", 
                                "Gravel"
                            ],
                            "reflection_loss": 9,
                            "transmission_loss": 15,
                            "diffusion": 2.0
                        },
                        {
                            "keys": [
                                "Black Concrete", 
                                "White Brick", 
                                "Blue Brick", 
                                "Tiles", 
                                "Yellow Brick"
                            ],
                            "reflection_loss": 1,
                            "transmission_loss": 90,
                            "diffusion": 1.0
                        },
                        {
                            "keys": [
                                "Rails", 
                                "Brushed Metal"
                            ],
                            "reflection_loss": 1,
                            "transmission_loss": 90,
                            "diffusion": 0.05
                        }
                    ]
                }
            },
            {
                name: 'Subway (Big)',
                thumbnailImage: 'subway_big.png',
                model: 'subway_big.glb',
                description: 'This is the description for the big subway model.',
                requestJson: {
                    "transmitters": [
                        {
                            "frq": 2432.0,
                            "txw": 0.05,
                            "pos": {
                                "x": 10,
                                "y": 4,
                                "z": 0
                            },
                            "antenna": {
                                "ant": 1,
                                "azi": 0,
                                "tlt": 0,
                                "pol": "v",
                                "hbw": 120,
                                "vbw": 120,
                                "txg": 0,
                                "fbr": 9,
                                "txl": 0
                            }
                        }
                    ],
                    "receiver": {
                        "rxg": 0,
                        "rxs": -80
                    },
                    "3d": {
                        "input_file": "subway_big.glb",
                        "max_reflections": 5
                    },
                    "output": {
                        "res": 0.7,
                        "col": "LTE.dBm",
                        "out": 2
                    },
                    "default_material": { 
                        "reflection_loss": 9.0,
                        "transmission_loss": 15.0,
                        "diffusion": 1.0
                    },
                    "materials": [
                        {
                            "keys": [
                                "Wood", 
                                "Gravel"
                            ],
                            "reflection_loss": 9,
                            "transmission_loss": 15,
                            "diffusion": 2.0
                        },
                        {
                            "keys": [
                                "Black Concrete", 
                                "White Brick", 
                                "Blue Brick", 
                                "Tiles", 
                                "Yellow Brick"
                            ],
                            "reflection_loss": 1,
                            "transmission_loss": 90,
                            "diffusion": 1.0
                        },
                        {
                            "keys": [
                                "Rails", 
                                "Brushed Metal"
                            ],
                            "reflection_loss": 1,
                            "transmission_loss": 90,
                            "diffusion": 0.05
                        }
                    ]
                }
            }
        ];

        const thumbnailsContainer = document.getElementById('thumbnails');

        demos.forEach((demo, index) => {
            const thumbnailContainer = document.createElement('div');
            thumbnailContainer.className = 'd-flex flex-column rounded bg-white text-black border';
            const containerSize = '180px';
            thumbnailContainer.style.minWidth = containerSize;
            thumbnailContainer.style.maxWidth = containerSize;
            thumbnailContainer.style.minHeight = containerSize;
            thumbnailContainer.style.maxHeight = containerSize;
            thumbnailContainer.style.cursor = 'pointer';
            thumbnailContainer.setAttribute('onclick', `loadDemo(${index})`);

            const thumbnailTitle = document.createElement('p');
            thumbnailTitle.className = 'flex-grow-0 m-0 text-center';
            thumbnailTitle.innerHTML = demo.name;

            const thumbnailImage = document.createElement('div');
            thumbnailImage.className = 'flex-grow-1 rounded-bottom';
            thumbnailImage.style.backgroundSize = 'cover';
            thumbnailImage.style.backgroundPosition = 'center';
            thumbnailImage.style.backgroundImage = `url(images/${demo.thumbnailImage})`;

            thumbnailContainer.appendChild(thumbnailTitle);
            thumbnailContainer.appendChild(thumbnailImage);
            thumbnailsContainer.appendChild(thumbnailContainer);
        });

        thumbnailsContainer.addEventListener('wheel', (event) => {
            event.preventDefault();
            thumbnailsContainer.scrollLeft += event.deltaY;
        });

        function loadDemo(index) {
            const demoDescriptionContainer = document.getElementById('demoDescription');
            const demoViewerContainer = document.getElementById('demoViewer');

            demoDescriptionContainer.innerHTML = '';
            demoViewerContainer.innerHTML = '';

            demoViewerContainer.style.height = '50vw';
            demoViewerContainer.style.width = '50vw';


            let descriptionHtml = `
                <h1>${demos[index].name}</h1>
                <a type="button" class="btn btn-sm btn-secondary" href="glbs/${demos[index].model}">Download Model</a>
                <hr>
                <p>${demos[index].description}</p>
            `;

            if(demos[index].requestJson) {
                const jsonString = JSON.stringify(demos[index].requestJson, null, 2);

                descriptionHtml += `
                    <hr>
                    <h2>Request JSON</h2>
                    <p>The following request JSON can be used with the CloudRF 3D Calculation API to produce a similar result.</p>
                    <pre>${jsonString}</pre>
                `;
            }

            demoDescriptionContainer.innerHTML = descriptionHtml;

            demoViewerContainer.innerHTML = `<model-viewer 
                                                src="glbs/${demos[index].model}" 
                                                ar 
                                                style="width: 100%; height: 100%"
                                                shadow-intensity="1" 
                                                camera-controls 
                                                touch-action="pan-y">
                                            </model-viewer>`;


        }
    </script>
</body>

</html>